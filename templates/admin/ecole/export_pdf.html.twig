<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Fiche √âcole - {{ ecole.nom }}</title>
    {{ encore_entry_link_tags('pdf-export') }}
</head>
<body>
    <div class="pdf-header">
        <h1>üìã Fiche √âcole - {{ ecole.nom }}</h1>
        <div class="subtitle">
            Code: <strong>{{ ecole.code }}</strong> | 
            G√©n√©r√© le {{ dateGeneration|date('d/m/Y √† H:i') }}
        </div>
    </div>

    {# Informations de l'√©cole #}
    <div class="pdf-section">
        <div class="section-title">üè´ Informations G√©n√©rales</div>
        <div class="pdf-info-grid">
            <div class="info-row">
                <div class="info-label">Code √âcole:</div>
                <div class="info-value"><span class="pdf-badge">{{ ecole.code }}</span></div>
            </div>
            <div class="info-row">
                <div class="info-label">Genre:</div>
                <div class="info-value"><span class="pdf-badge info">{{ ecole.genre }}</span></div>
            </div>
            <div class="info-row">
                <div class="info-label">Nom:</div>
                <div class="info-value"><span class="pdf-text-bold">{{ ecole.nom }}</span></div>
            </div>
            <div class="info-row">
                <div class="info-label">Adresse:</div>
                <div class="info-value">{{ ecole.adresse }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Ville:</div>
                <div class="info-value">{{ ecole.ville }} {{ ecole.codePostal }}</div>
            </div>
            <div class="info-row">
                <div class="info-label">Contact:</div>
                <div class="info-value">
                    üìû {{ ecole.telephone }}
                    {% if ecole.email %}
                        <br>üìß {{ ecole.email }}
                    {% endif %}
                </div>
            </div>
            <div class="info-row">
                <div class="info-label">Statut:</div>
                <div class="info-value">
                    <span class="pdf-badge {{ ecole.active ? 'success' : 'danger' }}">
                        {{ ecole.active ? 'Active' : 'Inactive' }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    {# Statistiques globales #}
    <div class="pdf-section">
        <div class="section-title">üìä Statistiques Globales</div>
        <div class="pdf-info-grid">
            <div class="info-row">
                <div class="info-label">Nombre de prises de vue:</div>
                <div class="info-value"><span class="pdf-text-bold">{{ prisesDeVue|length }}</span></div>
            </div>
            <div class="info-row">
                <div class="info-label">Total √©l√®ves photographi√©s:</div>
                <div class="info-value">
                    <span class="pdf-text-bold">
                        {% set totalEleves = 0 %}
                        {% for pdv in prisesDeVue %}
                            {% set totalEleves = totalEleves + pdv.nbEleves %}
                        {% endfor %}
                        {{ totalEleves }}
                    </span>
                </div>
            </div>
            <div class="info-row">
                <div class="info-label">Derni√®re prise de vue:</div>
                <div class="info-value">
                    {% if prisesDeVue|length > 0 %}
                        {% set dernierePrise = ecole.dernierePriseDeVue() %}
                        {% if dernierePrise %}
                            {{ dernierePrise.datePdv|date('d/m/Y') }}
                        {% else %}
                            <em class="pdf-text-muted">Aucune</em>
                        {% endif %}
                    {% else %}
                        <em class="pdf-text-muted">Aucune</em>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    {# D√©tail des prises de vue #}
    {% if prisesDeVue|length > 0 %}
        <div class="pdf-section">
            <div class="section-title">üì∏ D√©tail des Prises de Vue</div>
            
            <table class="pdf-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Type de prise de vue</th>
                        <th>Nb Classes</th>
                        <th>Nb √âl√®ves</th>
                        <th>Type de vente</th>
                        <th>Th√®me</th>
                        <th>Planches</th>
                        <th>Prix</th>
                    </tr>
                </thead>
                <tbody>
                    {% for priseDeVue in prisesDeVue %}
                        <tr class="pdf-no-break">
                            <td>{{ priseDeVue.datePdv|date('d/m/Y') }}</td>
                            <td>
                                {% if priseDeVue.typePrise %}
                                    {{ priseDeVue.typePrise.libelle }}
                                {% else %}
                                    <em class="pdf-small-text">Non sp√©cifi√©</em>
                                {% endif %}
                            </td>
                            <td class="pdf-text-center">
                                {% if priseDeVue.nbClasses %}
                                    {{ priseDeVue.nbClasses }}
                                {% else %}
                                    <em class="pdf-small-text">-</em>
                                {% endif %}
                            </td>
                            <td class="pdf-text-center">{{ priseDeVue.nbEleves }}</td>
                            <td>
                                {% if priseDeVue.typeVente %}
                                    {{ priseDeVue.typeVente.libelle }}
                                {% else %}
                                    <em class="pdf-small-text">Non sp√©cifi√©</em>
                                {% endif %}
                            </td>
                            <td>
                                {% if priseDeVue.theme %}
                                    {{ priseDeVue.theme.libelle }}
                                {% else %}
                                    <em class="pdf-small-text">Non sp√©cifi√©</em>
                                {% endif %}
                            </td>
                            <td class="pdf-small-text">
                                {# Utilisation de la m√©thode DTO pour afficher toutes les planches #}
                                {% set toutesLesPlanchesS√©lectionn√©es = priseDeVue.toutesLesPlanchesS√©lectionn√©es() %}
                                {% if toutesLesPlanchesS√©lectionn√©es|length > 0 %}
                                    {% for planche in toutesLesPlanchesS√©lectionn√©es %}
                                        <span class="pdf-text-bold">{{ planche.type|title }}:</span> {{ planche.libelle }}
                                        {% if planche.entity.prixParents is defined and planche.entity.prixParents %}
                                            ({{ planche.entity.prixParents }}‚Ç¨)
                                        {% endif %}
                                        <br>
                                    {% endfor %}
                                {% else %}
                                    <em class="pdf-text-muted">Aucune planche s√©lectionn√©e</em>
                                {% endif %}
                            </td>
                            <td class="pdf-text-right pdf-small-text">
                                {% if priseDeVue.prixEcole %}
                                    <span class="pdf-text-bold">√âcole:</span> {{ priseDeVue.prixEcole }}‚Ç¨<br>
                                {% endif %}
                                {% if priseDeVue.prixParent %}
                                    <span class="pdf-text-bold">Parent:</span> {{ priseDeVue.prixParent }}‚Ç¨
                                {% endif %}
                                {% if not priseDeVue.prixEcole and not priseDeVue.prixParent %}
                                    <em class="pdf-text-muted">Non renseign√©</em>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="pdf-section">
            <div class="section-title">üì∏ Prises de Vue</div>
            <p><em class="pdf-text-muted">Aucune prise de vue enregistr√©e pour cette √©cole.</em></p>
        </div>
    {% endif %}

    <div class="pdf-footer">
        Studio Prunelle - Fiche √âcole {{ ecole.code }} - G√©n√©r√© le {{ dateGeneration|date('d/m/Y √† H:i:s') }}
    </div>
</body>
</html> 